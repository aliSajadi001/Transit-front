const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfmake-DRy4WXpX.js","assets/index-pEbfshkB.js","assets/index-CDXns8tt.css"])))=>i.map(i=>d[i]);
import{c as L,_ as je,u as F,j as e,r as m,q as z,B as T,E as we,C as Re,X as Me,I as J,s as Fe,D as Z,v as Y,w as U,f as Q,x as W,h as ee,i as te,k as $,l as re,y as Ee,R as ae,F as Pe,m as Ie,n as ze,o as ie}from"./index-pEbfshkB.js";import{D as se,a as ne,b as ve,c as Ne,d as Ve,E as Le,u as _e,m as Ae,i as $e,j as Oe,k as He,l as Be,g as V,h as Ye,s as Ue,r as We}from"./dialog-DWvtxvnY.js";import{T as ye,C as de,D as qe}from"./textarea-DbcsO6L4.js";import{p as Xe,c as Ge,a as Ke,b as Je,$ as K}from"./arabic_ar-CYNL0_vA.js";import{C as Ze}from"./car-BpyLXwpi.js";/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ce=L("chevron-right",Qe);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],tt=L("download",et);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],st=L("file-down",at);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],lt=L("file-plus",nt);/**
 * @license lucide-react v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],rt=L("pencil",ot),me=["سواری","کامیون","موتورسیکلت","اتوبوس","ون","تریلی"],xe=["حمل‌ونقل شهری","بین‌شهری","بین‌المللی","پیک"],ue=["فعال","غیرفعال","در انتظار"];function it(){const t=new Date,a=new Date;a.setDate(t.getDate()-90);const n=a.getTime()+Math.random()*(t.getTime()-a.getTime());return new Date(n)}const dt=t=>Array.from({length:t},(a,n)=>{const o=it();return{id:n+1,type:xe[n%xe.length],vehicle:me[n%me.length],date:o.toISOString(),status:ue[n%ue.length]}});async function ct(){const t=await je(()=>import("./xlsx-DGuHH-KN.js"),[]);return t?.default??t}function mt(t){return t.replace(/[:\\/?*\[\]]/g," ").trim().slice(0,31)||"Data"}function xt(t){return/\.xlsx$/i.test(t)?t:`${t}.xlsx`}function ut(t,a,n=60){const o=t.length,l=new Array(o).fill(0);t.forEach((r,d)=>{l[d]=Math.max(l[d],String(r??"").length)});for(const r of a)for(let d=0;d<o;d++){const u=r?.[d],c=u==null?0:String(u).length;l[d]=Math.max(l[d],c)}return l.map(r=>({wch:Math.max(10,Math.min(r+2,n))}))}async function gt({headers:t,rows:a,sheetName:n="Data",fileName:o="table.xlsx",rtl:l=!0,autoFilter:r=!0,freezeHeader:d=!0,maxColWidth:u=60}){if(!t?.length)throw new Error("No headers provided");const c=await ct(),w=[t.map(k=>k==null?"":String(k)),...a.map(k=>(k??[]).map(M=>M??""))],j=c.utils.aoa_to_sheet(w);l&&(j["!rtl"]=!0),r&&j["!ref"]&&(j["!autofilter"]={ref:j["!ref"]}),d&&(j["!freeze"]={ySplit:1,topLeftCell:"A2"}),j["!cols"]=ut(t,a,u);const g=c.utils.book_new();c.utils.book_append_sheet(g,j,mt(n));const p=c.writeFileXLSX??c.writeFile??null,f=xt(o);if(p){p(g,f);return}const v=c.write(g,{bookType:"xlsx",type:"array"}),y=new Blob([v],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),R=URL.createObjectURL(y),N=document.createElement("a");N.href=R,N.download=f,N.rel="noopener",document.body.appendChild(N),N.click(),document.body.removeChild(N),setTimeout(()=>URL.revokeObjectURL(R),1e3)}let ge=!1,A=null;async function ht(t){const{headers:a,rows:n,fileName:o="table.pdf",title:l,landscapeThreshold:r=7}=t;if(!a?.length)throw alert("هیچ ستونی برای خروجی وجود ندارد."),new Error("No headers provided");if(typeof window>"u"||typeof document>"u")throw alert("ساخت PDF فقط در مرورگر قابل انجام است."),new Error("Not a browser environment");if(location.protocol==="file:")throw alert("اپ را با dev server اجرا کنید؛ اجرای مستقیم file:// جلوی فچ فونت را می‌گیرد."),new Error("Running on file://");const d=await je(()=>import("./pdfmake-DRy4WXpX.js").then(g=>g.p),__vite__mapDeps([0,1,2])),u=d.default||d;if(!u?.createPdf)throw alert("pdfmake به‌درستی بارگذاری نشد."),new Error("pdfmake not loaded");await pt(u);const c=[a.map(g=>({text:g==null?"":String(g),style:"tableHeader"})),...n.map(g=>g.map(p=>({text:p==null?"":String(p)})))],j={pageSize:"A4",pageOrientation:a.length>=r?"landscape":"portrait",pageMargins:[36,36,36,36],defaultStyle:{font:"Vazirmatn",fontSize:9,alignment:"center"},styles:{tableHeader:{bold:!0,margin:[0,4,0,4]}},content:[l?{text:String(l),bold:!0,fontSize:13,margin:[0,0,0,10],alignment:"center"}:void 0,{alignment:"center",table:{headerRows:1,widths:a.map(()=>"auto"),body:c},layout:{fillColor:g=>g===0?"#f5f5f5":g%2===0?"#e7e5e4":"#ffffff",hLineColor:()=>"#ddd",vLineColor:()=>"#eee",hLineWidth:(g,p)=>g===0||g===p.table.body.length?1:.5,vLineWidth:()=>.5,paddingLeft:()=>6,paddingRight:()=>6,paddingTop:()=>4,paddingBottom:()=>4}}].filter(Boolean)};try{u.createPdf(j).download(o)}catch{await bt(u,j,o)}}async function pt(t){if(!ge)return A||(A=(async()=>{const a="/fonts/Vazirmatn-Regular.ttf",n="/fonts/Vazirmatn-Bold.ttf",o=await he(a);if(!o)throw alert(`فونت فارسی یافت نشد:
${a}
لطفاً فایل Vazirmatn-Regular.ttf را در public/fonts قرار دهید.`),new Error("Regular font not reachable");const l=await he(n);t.vfs={...t.vfs,"Vazirmatn-Regular.ttf":o,...l?{"Vazirmatn-Bold.ttf":l}:{}},t.fonts={...t.fonts,Vazirmatn:{normal:"Vazirmatn-Regular.ttf",bold:l?"Vazirmatn-Bold.ttf":"Vazirmatn-Regular.ttf",italics:"Vazirmatn-Regular.ttf",bolditalics:l?"Vazirmatn-Bold.ttf":"Vazirmatn-Regular.ttf"}},ge=!0})(),A)}async function he(t){try{const a=await fetch(t,{method:"GET",cache:"no-store"});if(!a.ok)return null;const n=await a.blob(),o=await ft(n);return String(o).split(",")[1]||""||null}catch{return null}}function ft(t){return new Promise((a,n)=>{const o=new FileReader;o.onload=()=>a(String(o.result)),o.onerror=n,o.readAsDataURL(t)})}async function bt(t,a,n){return new Promise((o,l)=>{try{t.createPdf(a).getBlob(d=>{if(!d){alert("ساخت PDF ناموفق بود."),l(new Error("No blob from pdfmake"));return}const u=URL.createObjectURL(d),c=document.createElement("a");c.href=u,c.download=n,c.rel="noopener",document.body.appendChild(c),c.click(),document.body.removeChild(c),setTimeout(()=>URL.revokeObjectURL(u),1e3),o()})}catch(r){alert("ساخت PDF با خطا مواجه شد."),l(r)}})}function Ce(t){const a=(t||"fa").toLowerCase();return a.startsWith("fa")?{calendar:Ge,locale:Xe,format:"YYYY/MM/DD"}:a.startsWith("ar")?{calendar:Je,locale:Ke,format:"YYYY/MM/DD"}:{calendar:void 0,locale:void 0,format:"YYYY-MM-DD"}}function O(t,a){const n=Ce(a),o=new Date(t);return new K({calendar:n.calendar,locale:n.locale,date:o}).format(n.format)}function De({value:t}){const{i18n:a}=F(),n=O(t,a.language);return e.jsx("span",{children:n})}function jt({document:t,isOpen:a,onOpenChange:n,dir:o="rtl"}){const{t:l}=F();if(!t)return null;const r=t.status==="approved"?"bg-green-500":t.status==="rejected"?"bg-red-500":"bg-orange-400",d=o==="rtl",u=m.useMemo(()=>{const c=String(t.status).toLowerCase();return c==="approved"||c==="rejected"||c==="pending"?l(`docDetails.statusValues.${c}`):String(t.status)},[t.status,l]);return e.jsx(se,{open:a,onOpenChange:n,children:e.jsx(ne,{className:"!max-w-[83%] md:!max-w-[70%] rounded-xl p-0 overflow-hidden",dir:o,children:e.jsx("div",{className:"max-h-[80vh] overflow-y-auto p-6",children:e.jsxs("div",{className:`w-full flex flex-col ${d?"items-end":"items-start"} gap-6`,children:[e.jsx("div",{className:"w-full flex items-center justify-center md:justify-start md:items-start",children:e.jsx("p",{className:"text-purple-500 font-bold md:text-2xl md:pr-20",children:l("docDetails.title")})}),e.jsxs("div",{className:`flex w-full flex-col lg:flex-row items-center justify-center ${d?"items-end":"items-start"} gap-6`,children:[e.jsx("div",{className:"lg:w-1/3 w-full",children:e.jsx("img",{src:"https://airporttoyota.b-cdn.net/wp-content/uploads/new-toyotav2.webp",alt:t.vehicle?String(t.vehicle):l("docDetails.fallbacks.vehicleAlt"),className:"shadow-md shadow-gray-400 rounded-xl object-cover w-full h-auto"})}),e.jsxs("div",{className:"lg:w-2/3 w-full",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:d?"text-right":"text-left",children:[e.jsx(z,{className:"text-sm font-bold text-gray-700",children:l("docDetails.fields.status")}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded-sm text-xs font-medium text-white ${r}`,children:u})})]}),e.jsxs("div",{className:d?"text-right":"text-left",children:[e.jsx(z,{className:"text-sm font-bold text-gray-700",children:l("docDetails.fields.id")}),e.jsx("div",{className:"bg-gray-50 p-2 rounded-sm mt-1 text-sm",children:t.id})]}),e.jsxs("div",{className:d?"text-right":"text-left",children:[e.jsx(z,{className:"text-sm font-bold text-gray-700",children:l("docDetails.fields.date")}),e.jsx("div",{className:"bg-gray-50 p-2 rounded-sm mt-1 text-sm",children:e.jsx(De,{value:t.date})})]}),e.jsxs("div",{className:d?"text-right":"text-left",children:[e.jsx(z,{className:"text-sm font-bold text-gray-700",children:l("docDetails.fields.type")}),e.jsx("div",{className:"bg-gray-50 p-1 rounded-sm mt-1 text-sm",children:t.type})]}),e.jsxs("div",{className:d?"text-right":"text-left",children:[e.jsx(z,{className:"text-sm font-bold text-gray-700",children:l("docDetails.fields.vehicle")}),e.jsx("div",{className:"bg-gray-50 p-1 rounded-sm mt-1 text-sm",children:t.vehicle})]})]}),e.jsx("div",{className:"w-full border-t border-gray-200 my-4"}),e.jsx("p",{className:`text-stone-500 text-sm font-medium ${d?"text-right":"text-left"}`,children:l("docDetails.more")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:[e.jsxs(T,{variant:"outline",className:"flex items-center justify-center py-2 text-xs md:text-sm font-medium",type:"button",children:[e.jsx(we,{className:d?"mr-2 mt-1":"ml-2 mt-1",height:16,width:16}),e.jsx("span",{children:l("docDetails.actions.viewVehicleDetails")})]}),e.jsxs(T,{variant:"outline",className:"flex items-center justify-center py-2 text-xs md:text-sm font-medium",type:"button",children:[e.jsx(tt,{className:d?"mr-2":"ml-2",height:16,width:16}),e.jsx("span",{children:l("docDetails.actions.downloadInvoiceChecklist")})]})]})]})]})]})})})})}function wt({part:t,isOpen:a,onOpenChange:n,onSaveNote:o,dir:l="rtl"}){const{t:r}=F(),[d,u]=m.useState("");return m.useEffect(()=>{u(t?.note??"")},[t]),t?e.jsx(se,{open:a,onOpenChange:n,children:e.jsxs(ne,{dir:l,className:"sm:max-w-md w-[80%] rounded-xl p-5 max-h-[85vh] flex flex-col overflow-hidden",children:[e.jsxs(ve,{children:[e.jsx(Ne,{className:"text-lg font-semibold",children:r("partNote.title",{part:t.name})}),e.jsx(Ve,{className:"text-gray-600",children:r("partNote.description")})]}),e.jsx("div",{className:"mt-4 flex-1 overflow-auto",children:e.jsx(ye,{value:d,onChange:c=>u(c.target.value),placeholder:r("partNote.placeholder"),className:"w-full min-h-[160px] max-h-[50vh] resize-y overflow-auto text-base","aria-label":r("partNote.placeholder")})}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(T,{variant:"outline",onClick:()=>n(!1),className:"px-5",children:r("partNote.buttons.cancel")}),e.jsx(T,{onClick:()=>o(t.id,d),className:"px-5 bg-blue-600 hover:bg-blue-700",children:r("partNote.buttons.saveNote")})]})]})}):null}function vt({document:t,isOpen:a,onOpenChange:n,onSave:o,dir:l="rtl"}){const{t:r,i18n:d}=F();if(!t)return null;const u=l==="rtl",c=m.useMemo(()=>["engineOil","airFilter","brakePads","sparkPlugs","battery","wiperBlades","tire","headlight","radiator","alternator","clutchKit","fuelPump","ignitionCoil","oxygenSensor","shockAbsorber","starter","thermostat","timingBelt","waterPump","wheelBearing","cabinFilter","cvAxle","exhaustManifold","injector","glowPlug","horn","muffler","pcvValve","serpentineBelt","turbocharger"],[]),w=m.useMemo(()=>c.map((h,C)=>({id:C+1,name:r(`checklist.parts.${h}`),reserved:C<10})),[d.language]),[j,g]=m.useState(w),p=j.filter(h=>h.reserved),f=j.filter(h=>!h.reserved),[v,y]=m.useState(!1),[R,N]=m.useState(null),[k,M]=m.useState(""),[x,E]=m.useState("");m.useEffect(()=>{g(w),M(""),E(""),N(null),y(!1)},[t,w]);const _=(h,C)=>{g(P=>P.map(D=>D.id===h?{...D,reserved:!C}:D))},H=(h,C)=>{g(P=>P.map(D=>D.id===h?{...D,note:C}:D))},B=()=>{const h={documentId:t.id,reservedParts:p,stockParts:f,note:k,representative:x};o?.(h),n(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:a,onOpenChange:n,children:e.jsxs(ne,{className:"!max-w-[90%] md:!max-w-[70%] rounded-xl p-4 max-h-[90vh] overflow-hidden flex flex-col",dir:l,children:[e.jsx(ve,{children:e.jsxs(Ne,{className:"flex items-center pr-10 md:py-5 py-3 gap-2 text-lg font-bold",children:[e.jsx(Ze,{className:"text-stone-600",size:24}),e.jsx("span",{className:"md:text-base text-sm text-stone-600",children:r("checklist.title")})]})}),e.jsxs("div",{className:"overflow-auto flex-1",children:[e.jsx("div",{className:"bg-stone-200/60 shadow-md shadow-stone-300 rounded-lg p-4   mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[e.jsx("div",{className:`mb-3 md:mb-0 ${u?"text-right":"text-left"}`,children:e.jsx("p",{className:"font-semibold text-sm md:text-base text-stone-600",children:r("checklist.registrationInfo")})}),e.jsx("div",{className:"bg-stone-300/90 border border-stone-300 rounded-full px-4 py-2",children:e.jsx("p",{className:"font-mono md:text-base text-sm text-stone-700",children:r("checklist.vehicleAndModel",{vehicle:t.vehicle,year:2023})})})]})}),e.jsxs("div",{className:"border border-stone-200 shadow-md shadow-gray-300 md:p-5 p-2 rounded-lg",children:[e.jsxs("div",{className:"mb-6 bg-green-100 rounded-xl p-4 shadow-md shadow-green-300",children:[e.jsxs("p",{className:"font-semibold mb-3 text-stone-600 flex items-center md:text-base text-sm gap-2",children:[e.jsx("span",{className:"bg-green-100 text-green-800 rounded-full w-6 h-6 flex items-center justify-center",children:e.jsx(Re,{size:16})}),r("checklist.sections.availableReservedTitle")]}),p.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:p.map(h=>e.jsxs("div",{className:"bg-white border border-green-300 hover:scale-x-110 duration-300 transition-all rounded-lg p-3 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"md:text-sm text-stone-600 text-xs font-medium flex-1",children:h.name}),e.jsxs("div",{className:"relative w-14 h-6 bg-green-500 rounded-full cursor-pointer flex items-center justify-end px-1",onClick:()=>_(h.id,!0),"aria-label":r("common.yes"),title:r("common.yes"),children:[e.jsx("span",{className:"text-xs  font-bold text-white pr-6",children:r("common.yes")}),e.jsx("div",{className:"absolute right-1 w-4 h-4 bg-white rounded-full border border-green-500"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(T,{variant:"outline",className:"w-full flex items-center justify-center gap-1 text-blue-600 text-xs h-8",onClick:()=>{N(h),y(!0)},children:[e.jsx(lt,{size:12}),r("checklist.buttons.addNote")]})})]},h.id))}):e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 text-center text-stone-600",children:r("checklist.messages.noAvailableFound")})]}),e.jsxs("div",{className:"mb-6 bg-red-100 rounded-xl p-4 shadow-md shadow-red-300",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2 text-stone-600",children:[e.jsx("span",{className:"bg-gray-200 text-gray-700 rounded-full w-6 h-6 flex items-center justify-center",children:e.jsx(Me,{size:16})}),r("checklist.sections.unavailableTitle")]}),f.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:f.map(h=>e.jsx("div",{className:"bg-white border hover:scale-x-110 duration-300 transition-all border-gray-300 rounded-lg p-3 flex flex-col",children:e.jsxs("div",{className:"flex justify-between items-center h-full",children:[e.jsx("span",{className:"text-sm font-medium flex-1 text-stone-600",children:h.name}),e.jsxs("div",{className:"relative w-14 h-6 bg-gray-300 rounded-full cursor-pointer flex items-center justify-start px-1",onClick:()=>_(h.id,!1),"aria-label":r("common.no"),title:r("common.no"),children:[e.jsx("div",{className:"absolute left-1 w-4 h-4 bg-white rounded-full"}),e.jsx("span",{className:"text-xs font-bold pr-2 text-red-600 ml-5",children:r("common.no")})]})]})},h.id))}):e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 text-center text-red-600",children:r("checklist.messages.allAvailable")})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold mb-2 md:text-base text-sm text-stone-600",children:r("checklist.headings.note")}),e.jsx("div",{className:"border border-stone-200 rounded-xl p-4",children:e.jsx(ye,{className:"w-full rounded-xl p-4",rows:8,placeholder:r("checklist.placeholders.note"),value:k,onChange:h=>M(h.target.value)})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold mb-2 md:text-base text-sm text-stone-600",children:r("checklist.headings.borderRepresentative")}),e.jsx("div",{className:"border border-stone-200 rounded-xl p-4",children:e.jsx(J,{type:"text",className:"w-full rounded-md p-4",placeholder:r("checklist.placeholders.agentName"),value:x,onChange:h=>E(h.target.value)})})]}),e.jsxs("div",{className:"mt-6 relative",children:[e.jsx("h4",{className:"font-semibold mb-2 text-stone-600",children:r("checklist.headings.visitChart")}),e.jsx("div",{className:"border border-stone-200 rounded-xl p-4",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"relative w-full h-48",children:e.jsx("img",{alt:r("checklist.alts.visitChart"),className:"object-cover w-full rounded-xl shadow-md shadow-stone-900",src:"https://img.freepik.com/premium-vector/stock-market-graph-forex-trading-chart-business-financial-concepts-reports-investment-dark-background-vector-illustration_87788-496.jpg"})})})}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center text-sm pb-6 text-stone-200",children:r("checklist.chart.caption")})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx(T,{variant:"outline",onClick:()=>n(!1),className:"px-6",children:r("checklist.buttons.cancel")}),e.jsx(T,{className:"px-6 bg-green-600 hover:bg-green-700",onClick:B,children:r("checklist.buttons.save")})]})]})}),R&&e.jsx(wt,{part:R,isOpen:v,onOpenChange:y,onSaveNote:(h,C)=>{H(h,C),y(!1)},dir:l})]})}function Nt(t){switch(t){case"فعال":return"approved";case"غیرفعال":return"rejected";case"در انتظار":return"pending";default:return t}}function yt(t){return{id:t.id??t.documentId??"",date:t.date??t.createdAt??"",type:t.type??t.documentType??"",vehicle:t.vehicle??t.name??t.title??"",status:Nt(t.status??"")}}function Ct({data:t,onView:a,onEdit:n,onEditSubmit:o}){const{t:l}=F(),[r,d]=m.useState(!1),[u,c]=m.useState(!1),w=m.useMemo(()=>yt(t),[t]),j=w,g=m.useCallback(()=>{a?.(t),requestAnimationFrame(()=>d(!0))},[t,a]),p=m.useCallback(()=>{n?.(t),requestAnimationFrame(()=>c(!0))},[t,n]);return e.jsxs(Fe,{delayDuration:180,children:[e.jsxs(Z,{children:[e.jsxs(Y,{children:[e.jsx(U,{asChild:!0,children:e.jsx(Q,{asChild:!0,children:e.jsx(T,{type:"button",variant:"ghost",size:"icon","aria-label":l("dataTable.actions.menu.aria"),className:"h-8 w-8 p-0 grid place-items-center",children:e.jsx(Le,{className:"h-4 w-4"})})})}),e.jsx(W,{side:"top",className:"text-xs",children:l("dataTable.actions.tooltip.openMenu")})]}),e.jsxs(ee,{align:"end",sideOffset:4,className:"w-44",children:[e.jsx(te,{className:"text-stone-600",children:l("dataTable.actions.menu.title")}),e.jsx($,{}),e.jsxs(Y,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(re,{className:"cursor-pointer",onClick:g,"aria-label":l("dataTable.actions.view"),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:l("dataTable.actions.view")})]})}),e.jsx(W,{side:"left",className:"text-xs",children:l("dataTable.actions.tooltip.view")})]}),e.jsxs(Y,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(re,{className:"cursor-pointer",onClick:p,"aria-label":l("dataTable.actions.edit"),children:[e.jsx(rt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:l("dataTable.actions.edit")})]})}),e.jsx(W,{side:"left",className:"text-xs",children:l("dataTable.actions.tooltip.edit")})]})]})]}),e.jsx(jt,{document:w,isOpen:r,onOpenChange:d}),e.jsx(vt,{document:j,isOpen:u,onOpenChange:c,dir:"rtl",onSave:f=>{console.log("[RowActions] checklist save payload",{rowId:t.id,...f}),o?.(f,t)}})]})}const Dt=m.memo(Ct,(t,a)=>t.data?.id===a.data?.id&&t.onView===a.onView&&t.onEdit===a.onEdit&&t.onEditSubmit===a.onEditSubmit),pe=(t,a,n,o)=>{const l=We(String(t.getValue(a)??""),String(n??""));return o?.({itemRank:l}),l.passed},q=(t,a,n)=>{let o=0;const l=t.columnFiltersMeta?.[n]?.itemRank,r=a.columnFiltersMeta?.[n]?.itemRank;return l&&r&&(o=Ye(l,r)),o===0?Ue.alphanumeric(t,a,n):o},ke=ae.memo(function({value:a,onChange:n,debounce:o=500,className:l,...r}){const[d,u]=m.useState(a);return m.useEffect(()=>u(a),[a]),m.useEffect(()=>{const c=window.setTimeout(()=>n(String(d??"")),o);return()=>window.clearTimeout(c)},[d,o,n]),e.jsx(J,{...r,value:d??"",onChange:c=>u(c.target.value),className:"text-xs md:text-sm text-stone-600 placeholder:text-stone-600 "+(l??"")})}),kt=ae.memo(function({column:a,placeholder:n}){const o=a.getFilterValue(),l=m.useCallback(r=>a.setFilterValue(r),[a]);return e.jsx(ke,{type:"text",value:o??"",onChange:l,placeholder:n,className:"mt-1"})}),X=t=>{const a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0).getTime(),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999).getTime();return{start:a,end:n}},G=ae.memo(function({indeterminate:a,className:n="",...o}){const l=m.useRef(null);return m.useEffect(()=>{typeof a=="boolean"&&l.current&&(l.current.indeterminate=!o.checked&&a)},[a,o.checked]),e.jsx("input",{type:"checkbox",ref:l,className:n+" cursor-pointer",...o})});function fe({column:t,filterValue:a,t:n,bundle:o,lang:l}){const r=m.useRef(null),[d,u]=m.useState(typeof window<"u"?window.innerWidth<768:!1);m.useEffect(()=>{const p=()=>u(window.innerWidth<768);return window.addEventListener("resize",p,{passive:!0}),()=>window.removeEventListener("resize",p)},[]);const c=a?.start?new K({calendar:o.calendar,locale:o.locale,date:new Date(a.start)}):null,w=a?.end?new K({calendar:o.calendar,locale:o.locale,date:new Date(a.end)}):null,j=a?.start||a?.end?`${a?.start?`${n("dataTable.dateRange.from")} ${O(a.start,l)}`:""}${a?.start&&a?.end?" ":""}${a?.end?`${n("dataTable.dateRange.to")} ${O(a.end,l)}`:""}`:n("dataTable.dateRange.all"),g=m.useCallback(p=>{const v={...a||{},...p};!v.start&&!v.end?t.setFilterValue(void 0):t.setFilterValue(v)},[t,a]);return e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"px-2 py-1 border rounded bg-stone-100 text-stone-600 text-[11px]",onClick:()=>r.current?.openCalendar(),title:n("dataTable.dateRange.select"),"aria-label":n("dataTable.dateRange.select"),children:["📅 ",n("dataTable.dateRange.short")]}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded bg-white text-stone-600 text-[11px]",onClick:()=>{t.setFilterValue(void 0),r.current?.closeCalendar?.()},title:n("dataTable.dateRange.clear"),children:n("dataTable.dateRange.clear")}),e.jsx("span",{className:"text-[11px] md:text-xs text-stone-600",children:j}),e.jsx(qe,{ref:r,value:c&&w?[c,w]:c?[c]:void 0,onChange:p=>{const f=Array.isArray(p)?p:[];if(f.length===0){g({start:void 0,end:void 0});return}if(f.length===1&&f[0]?.toDate){const{start:v}=X(f[0].toDate());g({start:v,end:void 0});return}if(f.length>=2&&f[0]?.toDate&&f[1]?.toDate){const{start:v}=X(f[0].toDate()),{end:y}=X(f[1].toDate());g({start:v,end:y}),r.current?.closeCalendar?.()}},range:!0,rangeHover:!0,numberOfMonths:d?1:2,calendar:o.calendar,locale:o.locale,calendarPosition:d?"bottom":"bottom-center",portal:!0,shadow:!1,inputClass:"hidden"})]})}const be=(t,a,n)=>{const o=n??void 0;if(!o||!o.start&&!o.end)return!0;const l=new Date(t.getValue(a)).getTime(),r=typeof o.start=="number"?o.start:-1/0,d=typeof o.end=="number"?o.end:1/0;return l>=r&&l<=d};function St(t){return m.useMemo(()=>{const a=t.getPageCount(),n=t.getState().pagination.pageIndex,o=2,l=[],r=c=>l.push(c);if(a<=1)return l;const d=Math.max(0,n-o),u=Math.min(a-1,n+o);d>0&&(r(0),d>1&&r("..."));for(let c=d;c<=u;c++)r(c);return u<a-1&&(u<a-2&&r("..."),r(a-1)),l},[t])}function Tt({table:t}){const a=t.getAllLeafColumns().filter(o=>o.id!=="select"),{t:n}=F();return e.jsxs(Z,{children:[e.jsx(Q,{asChild:!0,children:e.jsx("button",{type:"button",className:"px-3 py-2 bg-white/80 backdrop-blur border rounded text-xs md:text-sm text-stone-600","aria-haspopup":"menu","aria-label":n("dataTable.columnsDropdown.manage"),children:n("dataTable.columnsDropdown.manage")})}),e.jsxs(ee,{align:"end",className:"w-56",children:[e.jsx(te,{className:"text-stone-600",children:n("dataTable.columnsDropdown.title")}),e.jsx($,{}),e.jsx(ie,{checked:t.getIsAllColumnsVisible(),onCheckedChange:()=>t.toggleAllColumnsVisible(),children:n("dataTable.columnsDropdown.showAll")}),e.jsx($,{}),a.map(o=>e.jsx(ie,{checked:o.getIsVisible(),onCheckedChange:()=>o.toggleVisibility(),children:V(o.columnDef.header,{column:o,table:t})},o.id)),e.jsx("div",{className:"px-2 pt-2 mt-2 text-[11px] text-stone-500",children:n("dataTable.columnsDropdown.selectSticky")})]})]})}function It(){const{t,i18n:a}=F(),[n,o]=m.useState([]),[l,r]=m.useState(""),[d,u]=m.useState({pageIndex:0,pageSize:10}),[c,w]=m.useState({}),[j,g]=m.useState({}),[p,f]=m.useState(typeof window<"u"?window.innerWidth<768:!1);m.useEffect(()=>{const s=()=>f(window.innerWidth<768);return window.addEventListener("resize",s,{passive:!0}),()=>window.removeEventListener("resize",s)},[]);const[v,y]=m.useState({pdf:!1,xls:!1}),R=m.useCallback(async(s,i)=>{try{y(b=>({...b,[i]:!0})),await s()}catch(b){console.error(`[export ${i}]`,b),alert(t(i==="pdf"?"dataTable.export.pdfError":"dataTable.export.xlsError"))}finally{y(b=>({...b,[i]:!1}))}},[t]),N=m.useMemo(()=>Ce(a.language),[a.language]),k=m.useMemo(()=>[{id:"expander",header:()=>null,cell:({row:s})=>s.getCanExpand()?e.jsx("button",{type:"button",onClick:s.getToggleExpandedHandler(),className:"p-1 text-stone-600 hover:text-stone-800","aria-label":s.getIsExpanded()?t("dataTable.collapse"):t("dataTable.expand"),"aria-expanded":s.getIsExpanded(),children:s.getIsExpanded()?e.jsx(de,{size:18}):e.jsx(ce,{size:18})}):e.jsx(Ee,{size:12,className:"text-stone-400"}),enableSorting:!1,enableColumnFilter:!1,enableHiding:!1,size:28},{id:"select",header:({table:s})=>e.jsx(G,{checked:s.getIsAllRowsSelected(),indeterminate:s.getIsSomeRowsSelected(),onChange:s.getToggleAllRowsSelectedHandler(),"aria-label":t("dataTable.select.allRows")}),cell:({row:s})=>e.jsx(G,{checked:s.getIsSelected(),disabled:!s.getCanSelect(),indeterminate:s.getIsSomeSelected(),onChange:s.getToggleSelectedHandler(),"aria-label":t("dataTable.select.row")}),enableSorting:!1,enableColumnFilter:!1,enableHiding:!1,size:32},{accessorKey:"id",header:t("dataTable.columns.id"),filterFn:"equalsString",cell:s=>s.getValue(),enableHiding:!0},{accessorKey:"type",header:t("dataTable.columns.type"),cell:s=>s.getValue(),filterFn:"includesString",sortingFn:q,enableHiding:!0},{accessorKey:"vehicle",header:t("dataTable.columns.vehicle"),cell:s=>s.getValue(),filterFn:"includesString",sortingFn:q,enableHiding:!0},{accessorKey:"date",header:t("dataTable.columns.date"),cell:s=>e.jsx(De,{value:s.getValue()}),filterFn:be,sortingFn:(s,i,b)=>new Date(s.getValue(b)).getTime()-new Date(i.getValue(b)).getTime(),enableHiding:!0},{accessorKey:"status",header:t("dataTable.columns.status"),cell:s=>{const i=s.getValue();return e.jsx("span",{className:`px-2 py-1 rounded text-xs ${i==="فعال"?"bg-green-100 text-green-700":i==="غیرفعال"?"bg-gray-100 text-gray-700":"bg-yellow-100 text-yellow-700"}`,children:i})},filterFn:"includesString",sortingFn:q,enableHiding:!0},{id:"actions",header:t("dataTable.columns.actions"),cell:({row:s})=>e.jsx(Dt,{data:s.original,onView:i=>console.log("VIEW:",i),onEdit:i=>console.log("EDIT:",i)}),enableSorting:!1,enableColumnFilter:!1,enableHiding:!0}],[t]),[M]=m.useState(()=>dt(50)),x=_e({data:M,columns:k,filterFns:{fuzzy:pe,dateBetween:be},state:{columnFilters:n,globalFilter:l,pagination:d,rowSelection:c,columnVisibility:j},onColumnFiltersChange:o,onGlobalFilterChange:r,onPaginationChange:u,onRowSelectionChange:w,onColumnVisibilityChange:g,enableRowSelection:!0,autoResetPageIndex:!1,globalFilterFn:pe,getCoreRowModel:Be(),getFilteredRowModel:He(),getSortedRowModel:Oe(),getPaginationRowModel:$e(),getExpandedRowModel:Ae(),getRowCanExpand:()=>!0}),E=m.useMemo(()=>n.find(i=>i.id==="date")?.value||void 0,[n]),_=St(x),H=m.useCallback(s=>{const i=Number(s.target.value),b=Number.isNaN(i)?1:Math.min(Math.max(i,1),x.getPageCount());x.setPageIndex(b-1)},[x]),B=m.useCallback(s=>{const i=x.getHeaderGroups().flatMap(b=>b.headers).find(b=>b.column.id===s.id);if(!i){const b=s.columnDef.header;return typeof b=="string"?b:s.id}return V(i.column.columnDef.header,i.getContext())},[x]),h=()=>{const s=x.getAllLeafColumns().filter(S=>S.getIsVisible()&&S.id!=="select"&&S.id!=="actions"&&S.id!=="expander"),i=s.map(S=>{const I=S.columnDef.header;return typeof I=="string"?I:S.id}),Te=(x.getFilteredRowModel().rows.length>0?x.getFilteredRowModel().rows:x.getRowModel().rows).map(S=>s.map(I=>{const oe=S.getValue(I.id);return I.id==="date"?O(oe,a.language):oe??""}));return{headers:i,rows:Te}},C=async()=>{const{headers:s,rows:i}=h();if(!s.length){alert(t("dataTable.export.noColumns"));return}await R(()=>gt({headers:s,rows:i,sheetName:"Data",fileName:"table.xlsx"}),"xls")},P=async()=>{const{headers:s,rows:i}=h();if(!s.length){alert(t("dataTable.export.noColumns"));return}await R(()=>ht({headers:s,rows:i,fileName:"table.pdf",title:t("dataTable.export.pdfTitle")}),"pdf")},D=x.getState().pagination.pageSize,Se=s=>x.setPageSize(s),le=({row:s})=>e.jsx("div",{className:"bg-stone-50 border border-stone-200 rounded-md p-3",children:e.jsx("pre",{className:"text-[11px] md:text-xs overflow-auto",children:e.jsx("code",{children:JSON.stringify(s.original,null,2)})})});return e.jsx("div",{className:"md:p-4 p-0 rounded-lg bg-gradient-to-r from-stone-200 via-stone-400 to-stone-200 min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"md:w-[90%] w-full md:rounded-xl md:p-9 p-2 bg-white/30  backdrop-blur-lg",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center text-stone-500 drop-shadow",children:t("dataTable.title")}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row items-stretch md:items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ke,{value:l??"",onChange:s=>r(String(s)),placeholder:t("dataTable.searchPlaceholder"),className:"border border-stone-300 focus-visible:ring-1 placeholder:pb-3"})}),p&&e.jsx(fe,{column:x.getColumn("date"),filterValue:E,t,bundle:N,lang:a.language}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2",children:[e.jsx(Tt,{table:x}),e.jsxs("button",{type:"button",onClick:C,className:"flex items-center gap-1 px-3 py-2 bg-white/80 backdrop-blur border rounded text-xs md:text-sm hover:bg-white disabled:opacity-60 text-stone-600",title:t("dataTable.export.excel"),disabled:v.xls,children:[e.jsx(st,{size:16}),"Excel"]}),e.jsxs("button",{type:"button",onClick:P,className:"flex items-center gap-1 px-3 py-2 bg-white/80 backdrop-blur border rounded text-xs md:text-sm hover:bg-white disabled:opacity-60 text-stone-600",title:t("dataTable.export.pdf"),disabled:v.pdf,children:[e.jsx(Pe,{size:16}),"PDF"]})]})]}),!p&&e.jsx("div",{className:"overflow-x-auto rounded-lg shadow hidden md:block",children:e.jsxs("table",{className:"w-full text-right bg-white rounded-lg",children:[e.jsx("thead",{className:"bg-stone-100 text-stone-600",children:x.getHeaderGroups().map(s=>e.jsx("tr",{children:s.headers.map(i=>e.jsx("th",{colSpan:i.colSpan,className:"px-4 py-3 text-sm font-semibold align-top",children:i.isPlaceholder?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.column.getCanSort()?"cursor-pointer select-none":"",onClick:i.column.getToggleSortingHandler(),children:[V(i.column.columnDef.header,i.getContext()),i.column.getIsSorted()==="asc"?" 🔼":i.column.getIsSorted()==="desc"?" 🔽":null]}),i.column.getCanFilter()?e.jsx("div",{className:"mt-1",children:i.column.id==="date"?e.jsx(fe,{column:i.column,filterValue:E,t,bundle:N,lang:a.language}):i.column.id==="select"||i.column.id==="expander"?null:e.jsx(kt,{column:i.column,placeholder:t("dataTable.filters.placeholder")})}):null]})},i.id))},s.id))}),e.jsx("tbody",{children:x.getRowModel().rows.map((s,i)=>e.jsxs(m.Fragment,{children:[e.jsx("tr",{className:(i%2===0?"bg-white":"bg-gray-50")+(s.getIsSelected()?" ring-2 ring-blue-300":""),children:s.getVisibleCells().map(b=>e.jsx("td",{className:"px-4 py-3 text-gray-700",children:V(b.column.columnDef.cell,b.getContext())},b.id))}),s.getIsExpanded()&&e.jsx("tr",{className:i%2===0?"bg-white":"bg-gray-50",children:e.jsx("td",{className:"px-4 py-3",colSpan:s.getVisibleCells().length,children:le({row:s})})})]},s.id))})]})}),p&&e.jsx("div",{className:"space-y-4 md:hidden",children:x.getRowModel().rows.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border "+(s.getIsSelected()?"border-blue-400":"border-transparent"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:t("dataTable.mobile.select")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:s.getToggleExpandedHandler(),className:"p-1 text-stone-600","aria-expanded":s.getIsExpanded(),"aria-label":s.getIsExpanded()?t("dataTable.collapse"):t("dataTable.expand"),children:s.getIsExpanded()?e.jsx(de,{size:18}):e.jsx(ce,{size:18})}),e.jsx(G,{checked:s.getIsSelected(),disabled:!s.getCanSelect(),indeterminate:s.getIsSomeSelected(),onChange:s.getToggleSelectedHandler(),"aria-label":t("dataTable.select.row")})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.getVisibleCells().filter(i=>i.column.id!=="select"&&i.column.id!=="expander").map(i=>e.jsxs(m.Fragment,{children:[e.jsxs("div",{className:"text-[11px] font-medium text-stone-600",children:[B(i.column),":"]}),e.jsx("div",{className:"text-xs text-gray-700",children:V(i.column.columnDef.cell,i.getContext())})]},i.id))}),s.getIsExpanded()&&e.jsx("div",{className:"mt-3",children:le({row:s})})]},s.id))}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"border rounded p-1 px-2 disabled:opacity-50 text-xs md:text-sm",onClick:()=>x.setPageIndex(0),disabled:!x.getCanPreviousPage(),"aria-label":t("dataTable.pagination.first"),children:"<<"}),e.jsx("button",{className:"border rounded p-1 px-2 disabled:opacity-50 text-xs md:text-sm",onClick:()=>x.previousPage(),disabled:!x.getCanPreviousPage(),"aria-label":t("dataTable.pagination.prev"),children:"<"}),e.jsx("div",{className:"flex items-center gap-1",children:_.map((s,i)=>s==="..."?e.jsx("span",{className:"px-2 text-gray-500 select-none text-xs md:text-sm",children:"…"},`dots-${i}`):e.jsx("button",{onClick:()=>x.setPageIndex(s),className:"border rounded px-2 py-1 text-xs md:text-sm "+(s===x.getState().pagination.pageIndex?"bg-blue-500 text-white":"bg-white"),"aria-label":`Go to page ${s+1}`,children:s+1},s))}),e.jsx("button",{className:"border rounded p-1 px-2 disabled:opacity-50 text-xs md:text-sm",onClick:()=>x.nextPage(),disabled:!x.getCanNextPage(),"aria-label":t("dataTable.pagination.next"),children:">"}),e.jsx("button",{className:"border rounded p-1 px-2 disabled:opacity-50 text-xs md:text-sm",onClick:()=>x.setPageIndex(x.getPageCount()-1),disabled:!x.getCanNextPage(),"aria-label":t("dataTable.pagination.last"),children:">>"})]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs md:text-sm text-white",children:[e.jsx("div",{children:t("dataTable.pagination.page")}),e.jsxs("strong",{className:"px-1",children:[x.getState().pagination.pageIndex+1," ",t("dataTable.pagination.of")," ",x.getPageCount()]})]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs md:text-sm",children:[e.jsx("span",{className:"text-white",children:t("dataTable.pagination.goto")}),e.jsx(J,{type:"number",min:1,max:x.getPageCount(),value:x.getState().pagination.pageIndex+1,onChange:H,className:"w-20 text-center text-stone-600 placeholder:text-stone-600"})]}),e.jsxs(Z,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(T,{variant:"outline",className:"text-xs md:text-sm",children:t("dataTable.pagination.perPage",{count:D})})}),e.jsxs(ee,{align:"end",className:"w-40",children:[e.jsx(te,{children:t("dataTable.pagination.pageSize")}),e.jsx($,{}),e.jsx(Ie,{value:String(D),onValueChange:s=>Se(Number(s)),children:[10,20,30,40,50].map(s=>e.jsx(ze,{value:String(s),children:s},s))})]})]})]}),e.jsx("div",{className:"mt-4 text-sm text-white",children:t("dataTable.pagination.rowsCount",{count:x.getPrePaginationRowModel().rows.length})})]})})}export{It as default};
